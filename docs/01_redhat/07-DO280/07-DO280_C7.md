# Capitulo 7 - Gesión de Operador de Kubernetes

Instalar y actualizar operadore del ciclo de vida y operadores de versión del cluster

- Explicar operadores y sus enfoques para instalar y actualizar
- Instalar y actualizar operadores por medio de la consola Web y el ciclo de vida
- Instalar y actualizar operadores mediante API del ciclo de vida 

## Operador de Kubernetes & el Administrador del Ciclo de vida de Operadores

Desplegar *Workloads* para K8S con recursos como **deplyments, replica sets, stateful sets, daemon sets, jobs y cron jobs**. Cada uno de los recursos desplegados cumplen una funcion en particular, por ejemplo: los **jobs** ejecutan una tarea única; los **cron jobs** ejecutan tareas periódicamente y los demás recursos crean *Workloads* persistentes. Los recursos como los deployment, los stateful sets o los daemon sets difieren en la forma en que se distribuye la carga de trabajo en un clúster.

Aqui las cargar pueden estar representadas por los diferentes modelos que existen para implementar en un clúster, sin embargo grandes *Workloads* pueden requerir diferentes componentes como un servidor de DB un servidor de backend o frontend. Las *Workloads* necesitan tareas de mantenimiento que se pueden automatizar 

Un operador tiene recursos personalizados (CRs Custom Resources). Los CRs del operador contienen la información necesaria para imnplementar y gestionar las *Workloads*. Un operador observa el clúster buscando instancias de CRs y luego crea los Workloads necesarios. 

### Implementación de operadores

| Tipo de Operador | Descripción |
|:---------------- |:----------- |
| Operadores de Clúster | Servicios de plataforma OCP (servidor Web y OAth)|
| Operadores Complementarios | (OLM - Operator Lifecycle Manager), Ayuda a instalar y actualizar los operadores en el clúster |
| Otros operadores | Desde los proveedores de SW diseñan y distrubuyen SW como manifiestos, chart de Helm y otro mecanismo de distribución |

#### Operadores de Clúster

EL CVO (Cluster Version Operator) instala y actualiza los operadores del clúster como parte de los procesos de instalación y actualización de OCP. El CVO provee información e inspecciona los recursos del clúster para examinar todo su estado. Esto incluye condiciones para identificar problemas 

```bash
oc get clusteroperator
```
Tambien se púede ir a **Administration** > **Cluster Settings** y luego en la pestaña **ClusterOperators**

#### Administrador del ciclo de vida de operadores y OperatorHub

Los admin pueden utilizar el OLM para instalar y actualizar operadores. Se usa la interfaz Web para interactuar con el OLM y proporciona CR para gestionar los operadores con el API de K8S. El OLM utiliza catálogos para encontrar los que están disponibles para instalar que son imágenes de contenedores con info de los operadores y sus versiones disponibles. Los catálogos disponibles son:

| Catálogo | Descripción |
|:-------- |:----------- |
|Red Hat | Operadores soportados por Red Hat |
|Certified | Operadores soportados por SW de terceros |
|Community | Operadores sin soporte oficial |
|Marketplace | Operadores con opción de comprar en le Red Hat Marketplace |

El OLM crea un recurso tipo **PackageManifest** para cada operador que esté disponible que también se pueden ver por el entorno Web. 

La implementación de operadores de compone de una definición de CR y Workloads de K8S. **NOTA:**  Un clúster contiene 2 Workloads por cada operador:
 1. Operador de Workloads. Gestiona el OLM.
 2. Los Workloads estan asociados con el CR y el gestor de imágenes. 

Se implementan operadores para automatizar cualquier tarea manual de K8S que se ajuste al patron del operador. Los SDK proporcionan componentes y marcos para el desarrollo de operadores.

 - ***Operador SDK*** contiene herramientas para desarrollar operadores con el lenguaje de programación Go y Ansible. También contiene tools para empaquetar chats de Helm.
 - ***Operador de Java SDK*** contiene herramientas para desarrollar operadores con el lenguaje Java. Tiene una extensión de Quarkus.

### Documentación

[Operadores en la documentación de OCP](https://docs.redhat.com/en/documentation/openshift_container_platform/4.14/html-single/operators/index) 

[SDK de operadores](https://sdk.operatorframework.io/) 

[SDK de operadores Java](https://javaoperatorsdk.io/) 

[SDK de operadores Quarkus](https://github.com/quarkiverse/quarkus-operator-sdk) 


## Instalación de operadores con la consola web

La consola Web de OCP proporciona una interfaz gráfica para el administrador de OLM. La página de **OperatorHub** muestra los operadores disponibles y cómo instalarlos, mientras los de la página **Installed Operators** muestra los que ya están instalados.


![OperatorHub](images/do288_c07_01.png){ width="600" height="400" style="display: block; margin: 0 auto" }

## Instalación de operadores con CLI